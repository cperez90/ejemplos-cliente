<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div id="app"></div>
<script>
    //MODEL
    let currentMode = "prompt"; // ðŸ”¹ Variable global que controla el modo
    let ranking = [];

    //SERVEIS
    function getRndInteger(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function play(player, machine) {
        if (player === machine) return 0;
        if (
            (player === 'piedra' && machine === 'tijeras') ||
            (player === 'papel' && machine === 'piedra') ||
            (player === 'tijeras' && machine === 'papel')
        ) return 1;
        return -1;
    }

    function askPlayer(OPCIONES) {
        let choice;
        while (true) {
            choice = prompt("Elije: Piedra / Papel / Tijeras");
            if (choice && OPCIONES.includes(choice.toLowerCase())) break;
            alert("Has de elegir una opciÃ³n vÃ¡lida");
        }
        return choice.toLowerCase();
    }

    function askMachine(OPCIONES) {
        return OPCIONES[getRndInteger(0, OPCIONES.length - 1)];
    }

    function imgHand(hand) {
        if (hand === 'piedra') return 'hand0.png';
        if (hand === 'papel') return 'hand5.png';
        if (hand === 'tijeras') return 'hand2.png';
    }

    // ðŸŽ® ACTIVAR MODO TECLAT
    function activarModeTeclat(OPCIONES) {
        document.addEventListener("keydown", (event) => {
            if (currentMode === "teclat") {
                const tecla = event.key.toLowerCase();
                let playerChoice;

                if (tecla === "r") playerChoice = "piedra";
                else if (tecla === "p") playerChoice = "papel";
                else if (tecla === "s") playerChoice = "tijeras";

                if (playerChoice) {
                    const machine = askMachine(OPCIONES);
                    const result = play(playerChoice, machine);
                    paintResult(playerChoice, machine, result);
                }
            }
        });
    }

    function reiniciarJoc() {
        ranking = [];
        const resultP = document.getElementById("result");
        const imgPlayer = document.getElementById("imgPlayer");
        const imgMachine = document.getElementById("imgMachine");
        resultP.textContent = "Resultat: ---";
        imgPlayer.src = "";
        imgMachine.src = "";
        paintRanking();
    }

    function jugarPrompt() {
        const OPCIONES = ["piedra", "papel", "tijeras"];
        const player = askPlayer(OPCIONES);
        const machine = askMachine(OPCIONES);
        const game = play(player, machine);
        paintResult(player, machine, game);
    }

    //VISTA

    function setupUI() {
        const app = document.querySelector("#app");
        app.innerHTML = ""; // limpiar al inicio

        const title = document.createElement("h2");
        title.textContent = "Mode de joc: Pedra, Paper o Tisores";
        app.appendChild(title);

        const label = document.createElement("label");
        label.textContent = "Selecciona el mode: ";
        label.setAttribute("for", "mode");
        app.appendChild(label);

        const select = document.createElement("select");
        select.id = "mode";

        const optPrompt = document.createElement("option");
        optPrompt.value = "prompt";
        optPrompt.textContent = "Prompt";
        const optTeclat = document.createElement("option");
        optTeclat.value = "teclat";
        optTeclat.textContent = "Teclat";

        select.appendChild(optPrompt);
        select.appendChild(optTeclat);
        app.appendChild(select);

        const playButton = document.createElement("button");
        playButton.textContent = "Jugar amb Prompt";
        app.appendChild(playButton);

        const resultP = document.createElement("p");
        resultP.id = "result";
        resultP.textContent = "Resultat: ---";
        app.appendChild(resultP);

        const imgPlayer = document.createElement("img");
        imgPlayer.id = "imgPlayer";
        imgPlayer.style.width = "150px";
        app.appendChild(imgPlayer);

        const imgMachine = document.createElement("img");
        imgMachine.id = "imgMachine";
        imgMachine.style.width = "150px";
        app.appendChild(imgMachine);

        // BotÃ³n reiniciar
        const resetButton = document.createElement("button");
        resetButton.textContent = "Reiniciar joc";
        resetButton.addEventListener("click", reiniciarJoc);

        // Botones extra
        let helpW;
        const btnHelp = document.createElement("button");
        btnHelp.textContent = "Ayuda";
        btnHelp.onclick = () => helpW = window.open("", "helpW", "width=600,height=400");

        const btnClose = document.createElement("button");
        btnClose.textContent = "Cerrar ayuda";
        btnClose.onclick = () => helpW && helpW.close();

        const btnPoli = document.createElement("button");
        btnPoli.textContent = "Politecnic";
        btnPoli.onclick = () => window.open("https://politecnicllevant.cat");

        app.appendChild(btnHelp);
        app.appendChild(btnClose);
        app.appendChild(btnPoli);
        app.appendChild(resetButton);

        // Crear tabla vacÃ­a
        paintRanking();

        // Listeners
        select.addEventListener("change", (event) => {
            currentMode = event.target.value;
            if (currentMode === "prompt") {
                resultP.textContent = "Mode: Prompt";
            } else {
                resultP.textContent = "Mode: Teclat (prem R, P o S)";
            }
        });

        playButton.addEventListener("click", () => {
            if (currentMode === "prompt") jugarPrompt();
        });
    }

    function paintResult(player, machine, result) {
        const resultP = document.getElementById("result");
        const imgPlayer = document.getElementById("imgPlayer");
        const imgMachine = document.getElementById("imgMachine");

        let guanyador;
        if (result === 1) guanyador = "Usuari";
        else if (result === 0) guanyador = "Empat";
        else guanyador = "MÃ quina";

        resultP.textContent = `Resultat: ${guanyador}`;

        imgPlayer.src = "./assets/" + imgHand(player);
        imgMachine.src = "./assets/" + imgHand(machine);

        imgPlayer.addEventListener('mouseover', () => {
            imgPlayer.src = './assets/hand5.png';
        });
        imgPlayer.addEventListener('mouseout', () => {
            imgPlayer.src = './assets/'+ imgHand(player);
        });

        imgMachine.addEventListener('mouseover', () => {
            imgMachine.src = './assets/hand5.png';
        });
        imgMachine.addEventListener('mouseout', () => {
            imgMachine.src = './assets/'+ imgHand(machine);
        });

        // guardar ranking
        ranking.push({ guanyador, usuari: player, maquina: machine });
        paintRanking();
    }

    function paintRanking() {
        const app = document.querySelector('#app');

        // Comprovar si la taula ja existeix, i si existeix, eliminar-la per tornar-la a crear
        const oldTable = document.querySelector("#ranking-table");
        if (oldTable) oldTable.remove();

        // Crear la taula
        const table = document.createElement("table");
        table.id = "ranking-table";
        table.style.marginTop = "20px";

        // Crear capÃ§alera
        const header = document.createElement("tr");
        ["Guanyador", "Usuari", "MÃ quina"].forEach(text => {
            const th = document.createElement("th");
            th.textContent = text;
            header.appendChild(th);
        });
        table.appendChild(header);

        // Afegir files amb les dades
        ranking.forEach(row => {
            const tr = document.createElement("tr");

            const tdGuanyador = document.createElement("td");
            tdGuanyador.textContent = row.guanyador;
            tr.appendChild(tdGuanyador);

            const tdUsuari = document.createElement("td");
            tdUsuari.textContent = row.usuari;
            tr.appendChild(tdUsuari);

            const tdMaquina = document.createElement("td");
            tdMaquina.textContent = row.maquina;
            tr.appendChild(tdMaquina);

            table.appendChild(tr);
        });

        app.appendChild(table);
    }


    //INIT
    function init() {
        setupUI();
        activarModeTeclat(["piedra", "papel", "tijeras"]);
    }
    init();
</script>

</body>
</html>