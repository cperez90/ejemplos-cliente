<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Piedra Papel Tijeras</title>
</head>
<body>
<div id="app"></div>
<script>
    //MODEL
    const OPCIONES = ['piedra','papel','tijeras'];
    //SERVEIS
    function getRndInteger(min,max){
        return Math.floor(Math.random()* (max -min +1)) + min;
    }

    /*
    * 0 = empate
    * 1 = ganar
    * -1 perder
    */
    function play(player, machine){
        if (player === machine){
            return 0;
        }else if(
            (player === 'piedra' && machine === 'tijeras') ||
            (player === 'papel' && machine === 'piedra') ||
            (player === 'tijeras' && machine === 'papel')
        ){
            return 1;
        }
        return -1;
    }
    //VISTA
    function askPlayer(){
        let isValid = false;
        let choice;
        while (!isValid){
            choice = prompt("Elije: Piedra / Papel / Tijeras");
            if (!OPCIONES.includes(choice.toLowerCase())){
                alert(("Has de elegir una opcion valida"))
            }else {
                isValid = true;
            }
        }

        return choice.toLowerCase();
        // TODO: ...
    }

    function  askMachine(){
        const random = getRndInteger(0,OPCIONES.length-1);
        return OPCIONES[random];
    }

    function paintResult(player,machine,result){
        console.log(player,machine,result);
        const app = document.querySelector('#app');
        const imgPlayer = document.createElement('IMG');
        const handPlayer = imgHand(player);
        imgPlayer.src = './assets/'+handPlayer;
        imgPlayer.style.width='300px';
        imgPlayer.addEventListener('mouseover', () => {
            imgPlayer.src = './assets/hand5.png';
        });
        imgPlayer.addEventListener('mouseout', () => {
            imgPlayer.src = './assets/'+handPlayer;
        });

        const imgMachine = document.createElement('IMG');
        const handMachine = imgHand(machine);
        imgMachine.src = './assets/'+handMachine;
        imgMachine.style.width='300px';
        imgMachine.addEventListener('mouseover', () => {
            imgMachine.src = './assets/hand5.png';
        });
        imgMachine.addEventListener('mouseout', () => {
            imgMachine.src = './assets/'+handMachine;
        });


        let helpW
        const windowsNew = document.createElement('BUTTON');
        windowsNew.innerText = 'ayuda';
        windowsNew.addEventListener('click', () => {
           helpW = window.open("","helpW","width=600, height=400");
        });

        const windowsClose = document.createElement('BUTTON');
        windowsClose.innerText = 'cerrar ayuda';
        windowsClose.addEventListener('click', () => {
            helpW.close();
        })

        const windowPoli = document.createElement('BUTTON');
        windowPoli.innerText = 'Politecnic';
        windowPoli.addEventListener('click', () => {
            window.open('https://politecnicllevant.cat');
        });

        app.appendChild(imgPlayer);
        app.appendChild(imgMachine);
        app.appendChild(windowsNew);
        app.appendChild(windowsClose);
        app.appendChild(windowPoli);
    }

    function imgHand(hand){
        let img;
        if (hand ==='piedra'){
            img = 'hand0.png';
        }else if (hand === 'papel'){
            img = 'hand5.png';
        }else if(hand === 'tijeras'){
            img = 'hand2.png';
        }
        return img;
    }

    //INIT
    function init(){
        const player = askPlayer();
        const machine = askMachine();
        const game = play(player,machine);
        paintResult(player,machine,game)
    }
    init();
</script>
</body>
</html>