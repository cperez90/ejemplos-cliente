<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Piedra Papel Tijeras</title>
</head>
<body>
<div id="app"></div>
<script>
    //MODEL

    //SERVEIS
    function getRndInteger(min,max){
        return Math.floor(Math.random()* (max -min +1)) + min;
    }

    /*
    * 0 = empate
    * 1 = ganar
    * -1 perder
    */
    function play(player, machine){
        if (player === machine){
            return 0;
        }else if(
            (player === 'piedra' && machine === 'tijeras') ||
            (player === 'papel' && machine === 'piedra') ||
            (player === 'tijeras' && machine === 'papel')
        ){
            return 1;
        }
        return -1;
    }
    function activarModeTeclat(OPCIONES,currentMode) {
        document.addEventListener("keydown", (event) => {
            if (currentMode === "teclat") {
                const tecla = event.key.toLowerCase();
                let playerChoice;

                if (tecla === "r") playerChoice = "piedra";
                else if (tecla === "p") playerChoice = "papel";
                else if (tecla === "s") playerChoice = "tijeras";

                if (playerChoice) {
                    const machine = askMachine(OPCIONES);
                    const result = play(playerChoice, machine);
                    paintResult(playerChoice, machine, result);
                }
            }
        });
    }
    //VISTA
    function askPlayer(OPCIONES){
        let isValid = false;
        let choice;
        while (!isValid){
            choice = prompt("Elije: Piedra / Papel / Tijeras");
            if (!OPCIONES.includes(choice.toLowerCase())){
                alert(("Has de elegir una opcion valida"))
            }else {
                isValid = true;
            }
        }

        return choice.toLowerCase();
        // TODO: ...
    }

    function  askMachine(OPCIONES){
        const random = getRndInteger(0,OPCIONES.length-1);
        return OPCIONES[random];
    }

    function paintResult(player,machine,result,currentMode){
        console.log(player,machine,result);
        const app = document.querySelector('#app');

        const title = document.createElement("h2");
        title.textContent = "Mode de joc: Pedra, Paper o Tisores";
        app.appendChild(title);

        const label = document.createElement("label");
        label.textContent = "Selecciona el mode: ";
        label.setAttribute("for", "mode");

        const select = document.createElement("select");
        select.id = "mode";

        const optPrompt = document.createElement("option");
        optPrompt.value = "prompt";
        optPrompt.textContent = "Prompt";

        const optTeclat = document.createElement("option");
        optTeclat.value = "teclat";
        optTeclat.textContent = "Teclat";

        select.appendChild(optPrompt);
        select.appendChild(optTeclat);

        app.appendChild(label);
        app.appendChild(select);

        const playButton = document.createElement("button");
        playButton.textContent = "Jugar amb Prompt";
        app.appendChild(playButton);

        const resultP = document.createElement("p");
        resultP.textContent = "Resultat: ---";
        app.appendChild(resultP);

        select.addEventListener("change", (event) => {
            currentMode = event.target.value;
            console.log("Mode canviat a:", currentMode);
            if (currentMode === "prompt") {
                resultP.textContent = "Has triat el mode Prompt";
            } else {
                resultP.textContent = "Has triat el mode Teclat (prem R, P o S)";
            }
        });

        const imgPlayer = document.createElement('IMG');
        const handPlayer = imgHand(player);
        imgPlayer.src = './assets/'+handPlayer;
        imgPlayer.style.width='300px';
        imgPlayer.addEventListener('mouseover', () => {
            imgPlayer.src = './assets/hand5.png';
        });
        imgPlayer.addEventListener('mouseout', () => {
            imgPlayer.src = './assets/'+handPlayer;
        });

        const imgMachine = document.createElement('IMG');
        const handMachine = imgHand(machine);
        imgMachine.src = './assets/'+handMachine;
        imgMachine.style.width='300px';
        imgMachine.addEventListener('mouseover', () => {
            imgMachine.src = './assets/hand5.png';
        });
        imgMachine.addEventListener('mouseout', () => {
            imgMachine.src = './assets/'+handMachine;
        });


        let helpW
        const windowsNew = document.createElement('BUTTON');
        windowsNew.innerText = 'ayuda';
        windowsNew.addEventListener('click', () => {
           helpW = window.open("","helpW","width=600, height=400");
        });

        const windowsClose = document.createElement('BUTTON');
        windowsClose.innerText = 'cerrar ayuda';
        windowsClose.addEventListener('click', () => {
            helpW.close();
        })

        const windowPoli = document.createElement('BUTTON');
        windowPoli.innerText = 'Politecnic';
        windowPoli.addEventListener('click', () => {
            window.open('https://politecnicllevant.cat');
        });

        app.appendChild(imgPlayer);
        app.appendChild(imgMachine);
        app.appendChild(windowsNew);
        app.appendChild(windowsClose);
        app.appendChild(windowPoli);
    }

    function imgHand(hand){
        let img;
        if (hand ==='piedra'){
            img = 'hand0.png';
        }else if (hand === 'papel'){
            img = 'hand5.png';
        }else if(hand === 'tijeras'){
            img = 'hand2.png';
        }
        return img;
    }

    //INIT
    function init(){
        const OPCIONES = ['piedra','papel','tijeras'];
        let currentMode = "prompt";
        activarModeTeclat(OPCIONES,currentMode);
        const player = askPlayer(OPCIONES);
        const machine = askMachine(OPCIONES);
        const game = play(player,machine);
        paintResult(player,machine,game,currentMode)
    }
    init();
</script>
</body>
</html>